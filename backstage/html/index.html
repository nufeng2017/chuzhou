<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="stylesheet" href="../src/layui/css/layui.css" />
	</head>

	<body style="padding-top: 100px;">
		<form class="layui-form" action="">
			<div class="layui-form-item">
				<div class="layui-inline">
					<label class="layui-form-label">姓名</label>
					<div class="layui-input-inline">
						<input type="text" name="username" lay-verify="" autocomplete="off" class="layui-input">
					</div>
				</div>
				<div class="layui-inline">
					<label class="layui-form-label">身份证号</label>
					<div class="layui-input-inline">
						<input type="text" name="idcard"  autocomplete="off" class="layui-input">
					</div>
				</div>
				<div class="layui-inline">
					<label class="layui-form-label">验证日期</label>
					<div class="layui-input-inline">
						<input type="text" name="reservation_time" id="date"  placeholder="yyyy-MM-dd" autocomplete="off" class="layui-input">
					</div>
				</div>
				<div class="layui-inline">
					<label class="layui-form-label">手机号码</label>
					<div class="layui-input-inline">
						<input type="tel" name="telphone"  autocomplete="off" class="layui-input">
					</div>
				</div>
			</div>
			<div class="layui-form-item">
			    <div class="layui-input-block">
			      	<button type="button" class="layui-btn layui-btn-normal" id="LAY-component-form-getval">导出</button>
			      	<button type="button"  data-type="reload" class="layui-btn selectAll" lay-submit="" lay-filter="demo1">查询</button>
			    </div>
			</div>
		</form>
		<script id="z-demo" type="text/html">
			<form class="layui-form" action="" style="padding-top: 20px;">
				<div class="layui-form-item">
					<div class="layui-inline">
						<label class="layui-form-label">姓名</label>
						<div class="layui-input-inline">
							<input type="text" name="username" lay-verify="" autocomplete="off" class="layui-input" value={{d.username}}>
						</div>
					</div>
					<div class="layui-inline">
						<label class="layui-form-label">身份证号</label>
						<div class="layui-input-inline">
							<input type="text" name="idcard" lay-verify="" autocomplete="off" class="layui-input" value={{d.idcard}}>
						</div>
					</div>
					<div class="layui-inline">
						<label class="layui-form-label">预约时间</label>
						<div class="layui-input-inline">
							<input type="text" name="reservation_time" id="date1"  placeholder="{{d.reservation_time}}" autocomplete="off" class="layui-input">
						</div>
					</div>
					<div class="layui-inline">
						<label class="layui-form-label">预约时间</label>
						<div class="layui-input-inline">
							<select name="times">
								<option value="8:30-9:00">8:30-9:00</option>
								<option value="9:00-9:30">9:00-9:30</option>
								<option value="9:30-10:00">9:30-10:00</option>
								<option value="10:00-10:30">10:00-10:30</option>
								<option value="10:30-11:00">10:30-11:00</option>
								<option value="11:30-12:00">11:30-12:00</option>
								<option value="14:00-14:30">14:00-14:30</option>
								<option value="14:30-15:00">14:30-15:00</option>
								<option value="15:00-15:30">15:00-15:30</option>
								<option value="15:30-16:00">15:30-16:00</option>
								<option value="16:00-16:30">16:00-16:30</option>
								<option value="16:30-17:00">16:30-17:00</option>
							</select>
						</div>
					</div>

					<div class="layui-inline">
						<label class="layui-form-label">手机号码</label>
						<div class="layui-input-inline">
							<input type="text" name="telphone" lay-verify="" autocomplete="off" class="layui-input" value={{d.telphone}}>
						</div>
					</div>
					<div class="layui-inline">
						<label class="layui-form-label">状态</label>
					    <div class="layui-input-inline">
					    	{{#  if(d.status=='2'){ }}
					      		<input type="radio" name="status" value="2" title="未联系" checked>
					      	{{#  } else { }}
					      		<input type="radio" name="status" value="1" title="未联系">
					      	{{#  } }}  
					      	{{#  if(d.status=='1'){ }}
					      		<input type="radio" name="status" value="1" title="已联系" checked>
					      	{{#  } else { }}
					      		<input type="radio" name="status" value="2" title="已联系">
					      	{{#  } }}  
					    </div>
					</div>
					<div class="layui-inline">
						<label class="layui-form-label">备注</label>
						<div class="layui-input-inline">
							<input type="text" name="remark" lay-verify="" autocomplete="off" class="layui-input" value={{d.remark}}>
							<input type="hidden" name="id" autocomplete="off" class="layui-input" value={{d.id}} >
						</div>
					</div>
				</div>
				<div class="layui-form-item">
				    <div class="layui-input-block">
				      	<button type="button"  data-type="reload" class="layui-btn selectAll" lay-submit="" lay-filter="*">确定</button>
				    </div>
				</div>
			</form>
		</script>
		<div id="z-view" style="display: none;"></div>
		<table class="layui-hide" id="test"  lay-filter="test"></table>
		<script type="text/html" id="barDemo">
			<a class="layui-btn layui-btn-xs " id="editone" lay-event="edit">修改</a>
		</script>
		<script src="../src/layui/layui.js" charset="utf-8"></script>
		<script src="../../js/jquery-3.4.1.min.js" charset="utf-8"></script>
		<script>
			window.onload=function(){
				$.ajax({
					type: "post",
					dataType: "json",
					url: "../adminList.php",
					data: {},
					success: function (data) {
						if (data.code==400){
							window.location.href='login.html';
						}
					}
				})
			};

			layui.use(['table','form', 'layedit', 'laydate'], function() {
				var table = layui.table;
				var util = layui.util;
				var laytpl = layui.laytpl;
				var form = layui.form,layer = layui.layer,layedit = layui.layedit,laydate = layui.laydate;
				//日期
			  	laydate.render({
			    	elem: '#date'
			  	});
				table.render({
					elem: '#test',
					url: '../adminList.php',
					title: '用户数据表',
					cols: [
						[{
							field: 'id',
							title: '序号',
							width: 80,
							fixed: 'left',
							unresize: true,
							// sort: true
						}, {
							field: 'username',
							title: '姓名',
							width: 120,
							edit: 'text'
						}, {
							field: 'idcard',
							title: '身份证号',
							width: 250,
							edit: 'text',
							// templet: function(res) {
							// 	return '<em>' + res.email + '</em>'
							// }
						}, {
							field: 'reservation_time',
							title: '预约时间',
							width: 250,
							edit: 'text',
							// sort: true
						}, {
							field: 'telphone',
							title: '手机号码',
							width: 150
						}, {
							field: 'status',
							title: '状态',
							width: 100
						}, {
							field: 'remark',
							title: '备注信息',
						}, {
							field: 'addtime',
							title: '提交时间',
							width: 250,
							templet:function(d){return util.toDateString(d.addtime*1000, "yyyy-MM-dd HH:mm:ss");}
						},{
							fixed: 'right',
							title: '操作',
							toolbar: '#barDemo',
							width: 80,
							templet: '#barDemo'
						}]
					],
					page: true,
					id:'textreload'
				});



				//查询条件返回结果
				var $=layui.$,active={
					reload:function(){
						var username =$("input[name='username']").val();
						var idcard =$("input[name='idcard']").val();
						var reservation_time =$("input[name='reservation_time']").val();
						reservation_time = reservation_time.replace(/-/g,".");
						var telphone =$("input[name='telphone']").val();
						table.reload('textreload',{
							url:'../adminList.php',
							method:'get',
							page: {
								curr: 1 //重新从第 1 页开始
							},
							where:{
								username:username,
								idcard:idcard,
								reservation_time:reservation_time,
								telphone:telphone
							}
						})

					}
				}
				//查询
				$('.selectAll').on('click', function(){
					var type = $(this).data('type');
					active[type] ? active[type].call(this) : '';
				});


				//导出数据
				$("#LAY-component-form-getval").click(function () {
					var username =$("input[name='username']").val();
					var idcard =$("input[name='idcard']").val();
					var reservation_time =$("input[name='reservation_time']").val();
					reservation_time = reservation_time.replace(/-/g,".");
					var telphone =$("input[name='telphone']").val();

					window.location.href = '../download-list.php?username='+username+'&idcard='+idcard+'&reservation_time='+reservation_time+'&telphone='+telphone;
					return;
				})

				var getTpl = document.getElementById('z-demo').innerHTML,view = document.getElementById('z-view');



				//监听行工具事件
				var tableObj;
				table.on('tool(test)', function(obj) {
					tableObj = obj;
					var data = obj.data;
					if(obj.event === 'edit') {
						laytpl(getTpl).render(data, function(html){
							view.innerHTML = html;
			  				form.render();
			  				laydate.render({
			    				elem: '#date1',
								format: 'yyyy-MM-dd'
								,type:'date'
								// ,min: 0 //7天前
								// ,max: 7 //7天后
			  				});
						});
						layer.open({
						  	type: 1, 
						  	title:'编辑',
						  	content: $('#z-view')
						});
					}
				});
				form.on('submit(*)', function(data){
					// console.log(data.field)
					// tableObj.update(data.field);
					var telephone = data.field.telphone;
					var len = telephone.length;
					if (len<11) {
						layer.msg('错误手机号！');
						return  false;
					}
					$.ajax({
						type: "get",
						dataType: "json",
						url: "../adminList.php?action=update",
						data:data.field
						,success: function (data) {
							if (data.code==200){
								layer.msg(data.msg);
								layer.closeAll();
								//重新刷新当前页
								window.parent.location.reload();
								// return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
							}else {
								layer.msg(data.msg);
							}
						}
					})

				});


			});
		</script>
	</body>

</html>