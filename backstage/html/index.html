<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="stylesheet" href="../src/layui/css/layui.css" />
	</head>

	<body style="padding-top: 100px;">
		<form class="layui-form" action="">
			<div class="layui-form-item">
				<div class="layui-inline">
					<label class="layui-form-label">姓名</label>
					<div class="layui-input-inline">
						<input type="text" name="username" lay-verify="" autocomplete="off" class="layui-input">
					</div>
				</div>
				<div class="layui-inline">
					<label class="layui-form-label">身份证号</label>
					<div class="layui-input-inline">
						<input type="text" name="idcard"  autocomplete="off" class="layui-input">
					</div>
				</div>
				<div class="layui-inline">
					<label class="layui-form-label">验证日期</label>
					<div class="layui-input-inline">
						<input type="text" name="reservation_time" id="date"  placeholder="yyyy-MM-dd" autocomplete="off" class="layui-input">
					</div>
				</div>
				<div class="layui-inline">
					<label class="layui-form-label">手机号码</label>
					<div class="layui-input-inline">
						<input type="tel" name="telphone"  autocomplete="off" class="layui-input">
					</div>
				</div>
			</div>
			<div class="layui-form-item">
			    <div class="layui-input-block">
			      	<button type="button" class="layui-btn layui-btn-normal" id="LAY-component-form-getval">导出</button>
			      	<button type="button"  data-type="reload" class="layui-btn selectAll" lay-submit="" lay-filter="demo1">查询</button>
			    </div>
			</div>
		</form>
		<table class="layui-hide" id="test"  lay-filter="test"></table>
		<script type="text/html" id="barDemo">
			<a class="layui-btn layui-btn-xs" lay-event="edit">修改</a>
		</script>
		<script src="../src/layui/layui.js" charset="utf-8"></script>
		<script src="../../js/jquery-3.4.1.min.js" charset="utf-8"></script>
		<script>
			layui.use(['table','form', 'layedit', 'laydate'], function() {
				var table = layui.table;
				var util = layui.util;
				var form = layui.form,layer = layui.layer,layedit = layui.layedit,laydate = layui.laydate;
				//日期
			  	laydate.render({
			    	elem: '#date'
			  	});
				table.render({
					elem: '#test',
					url: '../adminList.php',
					title: '用户数据表',
					cols: [
						[{
							field: 'id',
							title: '序号',
							width: 80,
							fixed: 'left',
							unresize: true,
							// sort: true
						}, {
							field: 'username',
							title: '姓名',
							width: 120,
							edit: 'text'
						}, {
							field: 'idcard',
							title: '身份证号',
							width: 250,
							edit: 'text',
							// templet: function(res) {
							// 	return '<em>' + res.email + '</em>'
							// }
						}, {
							field: 'reservation_time',
							title: '预约时间',
							width: 250,
							edit: 'text',
							// sort: true
						}, {
							field: 'telphone',
							title: '手机号码',
							width: 150
						}, {
							field: 'status',
							title: '状态',
							width: 100
						}, {
							field: 'remark',
							title: '备注信息',
							width: 100
						}, {
							field: 'addtime',
							title: '提交时间',
							width: 250,
							templet:function(d){return util.toDateString(d.addtime*1000, "yyyy-MM-dd HH:mm:ss");}
						},{
							fixed: 'right',
							title: '操作',
							toolbar: '#barDemo',
							width: 150
						}]
					],
					page: true,
					id:'textreload'
				});



				//查询条件返回结果
				var $=layui.$,active={
					reload:function(){
						var username =$("input[name='username']").val();
						var idcard =$("input[name='idcard']").val();
						var reservation_time =$("input[name='reservation_time']").val();
						reservation_time = reservation_time.replace(/-/g,".");
						var telphone =$("input[name='telphone']").val();
						table.reload('textreload',{
							url:'../adminList.php',
							method:'get',
							page: {
								curr: 1 //重新从第 1 页开始
							},
							where:{
								username:username,
								idcard:idcard,
								reservation_time:reservation_time,
								telphone:telphone
							}
						})

					}
				}
				//查询
				$('.selectAll').on('click', function(){
					var type = $(this).data('type');
					active[type] ? active[type].call(this) : '';
				});


				//导出数据
				$("#LAY-component-form-getval").click(function () {
					var username =$("input[name='username']").val();
					var idcard =$("input[name='idcard']").val();
					var reservation_time =$("input[name='reservation_time']").val();
					reservation_time = reservation_time.replace(/-/g,".");
					var telphone =$("input[name='telphone']").val();

					window.location.href = '../download-list.php?username='+username+'&idcard='+idcard+'&reservation_time='+reservation_time+'&telphone='+telphone;
					return;
				})


				//监听行工具事件
				table.on('tool(test)', function(obj) {
					var data = obj.data;
					if(obj.event === 'edit') {
						layer.prompt({
							formType: 2,
							value: data.email
						}, function(value, index) {
							obj.update({
								email: value
							});
							layer.close(index);
						});
					}
				});
			});
		</script>
	</body>

</html>