<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
		<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<link rel="stylesheet" type="text/css" href="../css/public/hui.css" />
		<link rel="stylesheet" type="text/css" href="../css/public.css" />
		<script type="text/javascript" src="../js/public/flexible.js"></script>
	</head>

	<body>
		<div class="hui-head"><span>网</span><span>上</span><span>预</span><span>约</span><span>系</span><span>统</span></div>
		
		<!--logo-->
		<div class="hui-logo">
			<img src="../img/logo-1.png" alt="" />
		</div>
		
		<!--表格-->
		<div class="hui-form">
			<div class="hui-form-item hui-flex hui-flex-align-center">
				<label for="" class="hui-flex hui-flex-justify"><span>姓</span><span>名：</span></label>
				<div class="hui-form-box hui-flex-item">
					<input type="text"  class="username"/>
				</div>
			</div>
			<div class="hui-form-item hui-flex hui-flex-align-center">
				<label for="" class="hui-flex hui-flex-justify"><span>身</span><span>份</span><span>证</span><span>号：</span></label>
				<div class="hui-form-box hui-flex-item">
					<input type="text" class="idcard"/>
				</div>
			</div>
			<div class="hui-form-item hui-flex hui-flex-align-center" id="btn1">
				<label for="" class="hui-flex hui-flex-justify"><span>预</span><span>约</span><span>时</span><span>间：</span></label>
				<div class="hui-form-box hui-flex-item">
					<div class="nowtime"></div>
				</div>
			</div>
			<div class="hui-form-item hui-flex hui-flex-align-center">
				<label for=""class="hui-flex hui-flex-justify"><span>手</span><span>机</span><span>号：</span></label>
				<div class="hui-form-box hui-flex-item">
					<input type="text" class="telphone"/>
					<div class="hui-get-code" id="sendcode">获取验证码</div>
				</div>
			</div>
			<div class="hui-form-item hui-flex hui-flex-align-center">
				<label for=""class="hui-flex hui-flex-justify"><span>验</span><span>证</span><span>码：</span></label>
				<div class="hui-form-box hui-flex-item">
					<input type="text" class="code"/>
				</div>
			</div>
		</div>
		
		<!--提交提醒-->
		<div class="hui-submit-tips">
			请仔细阅读办理资料，携带所有需要的材料<br/>如有疑问请致电：0550-3055300
		</div>
		
		<!--提交按钮-->
		<div class="hui-submit-btn  addone"><span>提</span>交</div>
		
		<!--底部按钮-->
		<div class="hui-bottom-btn"><span>我</span><span>要</span><span>帮</span><span>助</span></div>
		
	</body>
	<script type="text/javascript" src="../js/public/hui.js"></script>
	<script type="text/javascript" src="../js/public/hui-picker.js"></script>
	<script type="text/javascript" src="../js/index.js"></script>
	<script type="text/javascript" src="../js/jquery-3.4.1.min.js"></script>
</html>

<script>
	/** 未来七天的工作日  去除周六周日**/
	function getworkday(dat,itervalByDay){
		var str=dat.split("-");
		var date=new Date();
		date.setUTCFullYear(str[0], str[1] - 1, str[2]);
		date.setUTCHours(0, 0, 0, 0);
		var millisceonds =date.getTime();
		for(var i=1;i<=itervalByDay;i++){
			millisceonds +=24*60*60*1000;
			date.setTime(millisceonds);
			if(date.getDay()==0||date.getDay()==6) i--;
		}
		var year = date.getFullYear();
		var month = date.getMonth() + 1;
		var day = date.getDate();
		month = ('00'+month).slice(-2);
		day = ('00'+day).slice(-2);
		var rq = year + "-" +  month + "-" + day;
		return rq;
	}
	//返回星期几
	function getday(dats,itervalByDays){
		var str=dats.split("-");
		var date=new Date();
		date.setUTCFullYear(str[0], str[1] - 1, str[2]);
		date.setUTCHours(0, 0, 0, 0);
		var millisceondss =date.getTime();
		for(var i=1;i<=itervalByDays;i++){
			millisceondss +=24*60*60*1000;
			date.setTime(millisceondss);
			if(date.getDay()==0||date.getDay()==6) i--;
		}
		var days = date.getDay();
		var rqs = days;
		return rqs;
	}

	let obj=[],Days=["星期日", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六"];
	var now = new Date();
	var year = now.getFullYear(); //得到年份
	var month = now.getMonth()+1;//得到月份
	var date = now.getDate()+1;
	var Nowadays = year+'-'+month+'-'+date;
	for(var i = 0 ; i < 7 ; i++){
		var str = Days[getday(Nowadays,i)];
		obj.push({value:getworkday(Nowadays,i)+'/'+str,text:getworkday(Nowadays,i)+'/'+str});
		obj[i].children = [{value:'8:30-9:00',text:'8:30-9:00'},{value:'9:00-9:30',text:'9:00-9:30'},{value:'9:30-10:00',text:'9:30-10:00'},{value:'10:00-10:30',text:'10:00-10:30'},{value:'10:30-11:00',text:'10:30-11:00'},{value:'11:00-11:30',text:'11:00-11:30'},{value:'11:30-12:00',text:'11:30-12:00'},{value:'14:00-14:30',text:'14:00-14:30'},{value:'14:30-15:00',text:'14:30-15:00'},{value:'15:00-15:30',text:'15:00-15:30'},{value:'15:30-16:00',text:'15:30-16:00'},{value:'16:00-16:30',text:'16:00-16:30'},{value:'16:30-17:00',text:'16:30-17:00'}];
	}
	/**未来七天的工作日  去除周六周日  **/

	window.onload=function(){
		var Oneday = getworkday(Nowadays,0);
		var Sevenday = getworkday(Nowadays,6);
		$.ajax({
			type: "post",
			url: "../reservation.php?action=configInit",
			dataType:"json",
			data: {
				 obj:obj
				,oneday:Oneday
				,Sevenday:Sevenday
			},
			success: function (data) {
				datesss = data;
			}
		})
	};


	$(function () {
        /* 普通选择器 非关联型绑定 */
		var picker1 = new huiPicker('#btn1', function(){
			var val = picker1.getVal(0);
			var txt = picker1.getText(0);
			var txt1 = picker1.getText(1);
			hui('#btn1 .hui-form-box>div').html(txt+'/'+txt1);
		});
		picker1.level = 2;
        $(".nowtime").click(function () {
            picker1.bindRelevanceData(datesss);
        });
		

		//开始预约
		$(".addone").click(function () {
			var time = $(".nowtime").html();
			var username = $(".username").val();
			var idcard = $(".idcard").val();
			var telphone = $(".telphone").val();
			var code = $(".code").val();
			$.ajax({
				type: "post",
				dataType: "json",
				url: "../reservation.php?action=add",
				data: {
					action:'add',
					username:username,
					idcard:idcard,
					telphone:telphone,
					code:code,
					time:time
				},
				success: function (data) {
					if (data.code==200){
						window.location.href=data.urll;
					} else if (data.code==400){
						alert(data.msg);
					}
				}

			})
		})
		/** 发送短信验证码 **/
		$("#sendcode").click(function () {
			var telphone = $(".telphone").val();
			var strTemp = /^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1})|(14[0-9]{1})|)+\d{8})$/;
			if (!telphone){
				alert('请填写手机号码！');
				return false;
			}else if (telphone.length!=11 && !strTemp.test(telphone)){
				alert('手机号码格式错误！');
				return false;
			}
			//使用倒计时
			setintervaltime();
			$.ajax({
				type:"post",
				dataType: "json",
				data:{
					telphone:telphone
				},
				url:"../reservation.php?action=send",
				success:function(data){
					if (data.code==200){
						alert(data.msg);
					} else if (data.code==200){
						alert(data.msg);
					}
				}
			})
		})
	})
	
	$(".hui-bottom-btn").click(function () {
		location.href='help.html';

	})
	
</script>